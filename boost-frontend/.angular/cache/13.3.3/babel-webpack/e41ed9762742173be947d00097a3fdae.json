{"ast":null,"code":"import { ElementRef } from '@angular/core';\nimport { ChapterDto } from \"../chapters/chapterdto\";\nimport { faPlus, faSave, faTimes } from \"@fortawesome/free-solid-svg-icons\";\nimport { AudioPlayerComponent } from \"../audio-player/audio-player.component\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../service/chapter.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../service/authenticationservice\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"ngx-autofocus-fix\";\nimport * as i7 from \"@fortawesome/angular-fontawesome\";\nimport * as i8 from \"ngx-autosize\";\nimport * as i9 from \"../audio-player/audio-player.component\";\nconst _c0 = [\"title\"];\n\nfunction ChapterDetailComponent_div_0_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 8);\n    i0.ɵɵlistener(\"click\", function ChapterDetailComponent_div_0_div_1_Template_div_click_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return ctx_r6.toggleTitle();\n    });\n    i0.ɵɵelementStart(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"span\", 9);\n    i0.ɵɵelementStart(4, \"span\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"ngClass\", \"dotted mb-2 badge p-2 text-left \" + (ctx_r2.isChecked() ? \"badge-primary\" : \"badge-secondary\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"\", ctx_r2.chapter.order, \". \", ctx_r2.chapter.title, \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r2.getTimeDuration(ctx_r2.chapter));\n  }\n}\n\nfunction ChapterDetailComponent_div_0_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 10)(1, \"input\", 11, 12);\n    i0.ɵɵlistener(\"focusout\", function ChapterDetailComponent_div_0_div_2_Template_input_focusout_1_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext(2);\n      return ctx_r9.toggleTitle();\n    })(\"ngModelChange\", function ChapterDetailComponent_div_0_div_2_Template_input_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r11 = i0.ɵɵnextContext(2);\n      return ctx_r11.chapter.title = $event;\n    })(\"keydown.enter\", function ChapterDetailComponent_div_0_div_2_Template_input_keydown_enter_1_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r12 = i0.ɵɵnextContext(2);\n      return ctx_r12.updateChapter($event, \"editTitle\");\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 13)(4, \"button\", 14);\n    i0.ɵɵlistener(\"click\", function ChapterDetailComponent_div_0_div_2_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r13 = i0.ɵɵnextContext(2);\n      return ctx_r13.toggleTitle();\n    });\n    i0.ɵɵelement(5, \"fa-icon\", 15);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"autofocus\", true)(\"ngModel\", ctx_r3.chapter.title);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"icon\", ctx_r3.faTimes);\n  }\n}\n\nfunction ChapterDetailComponent_div_0_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 10)(1, \"textarea\", 16, 17);\n    i0.ɵɵlistener(\"ngModelChange\", function ChapterDetailComponent_div_0_div_3_Template_textarea_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r15 = i0.ɵɵnextContext(2);\n      return ctx_r15.chapter.description = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 13)(4, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function ChapterDetailComponent_div_0_div_3_Template_button_click_4_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r17 = i0.ɵɵnextContext(2);\n      return ctx_r17.updateChapter($event, \"editDescription\");\n    });\n    i0.ɵɵelement(5, \"fa-icon\", 15);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 13)(7, \"button\", 14);\n    i0.ɵɵlistener(\"click\", function ChapterDetailComponent_div_0_div_3_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r18 = i0.ɵɵnextContext(2);\n      return ctx_r18.toggleDescription();\n    });\n    i0.ɵɵelement(8, \"fa-icon\", 15);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"autofocus\", true)(\"ngModel\", ctx_r4.chapter.description);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"icon\", ctx_r4.faSave);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"icon\", ctx_r4.faTimes);\n  }\n}\n\nfunction ChapterDetailComponent_div_0_blockquote_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"blockquote\", 19);\n    i0.ɵɵlistener(\"click\", function ChapterDetailComponent_div_0_blockquote_4_Template_blockquote_click_0_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r19 = i0.ɵɵnextContext(2);\n      return ctx_r19.toggleDescription();\n    });\n    i0.ɵɵelementStart(1, \"cite\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r5.chapter.description ? ctx_r5.chapter.description : \"No description for this chapter\");\n  }\n}\n\nfunction ChapterDetailComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵtemplate(1, ChapterDetailComponent_div_0_div_1_Template, 6, 4, \"div\", 5);\n    i0.ɵɵtemplate(2, ChapterDetailComponent_div_0_div_2_Template, 6, 3, \"div\", 6);\n    i0.ɵɵtemplate(3, ChapterDetailComponent_div_0_div_3_Template, 9, 4, \"div\", 6);\n    i0.ɵɵtemplate(4, ChapterDetailComponent_div_0_blockquote_4_Template, 3, 1, \"blockquote\", 7);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.editTitle);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.editTitle);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.editDescription);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.editDescription);\n  }\n}\n\nfunction ChapterDetailComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r22 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 20)(1, \"label\", 21);\n    i0.ɵɵtext(2, \"set as Current track\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"input\", 22);\n    i0.ɵɵlistener(\"change\", function ChapterDetailComponent_div_3_Template_input_change_3_listener($event) {\n      i0.ɵɵrestoreView(_r22);\n      const ctx_r21 = i0.ɵɵnextContext();\n      return ctx_r21.updateCurrentChapter($event);\n    });\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"htmlFor\", \"currentChap\" + ctx_r1.chapter.id);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"id\", \"currentChap\" + ctx_r1.chapter.id)(\"disabled\", ctx_r1.isChecked())(\"checked\", ctx_r1.isChecked());\n  }\n}\n\nexport let ChapterDetailComponent = /*#__PURE__*/(() => {\n  class ChapterDetailComponent {\n    constructor(chapterService, router, cd, authenticationService) {\n      this.chapterService = chapterService;\n      this.router = router;\n      this.cd = cd;\n      this.authenticationService = authenticationService;\n      this.faPlus = faPlus;\n      this.faTimes = faTimes;\n      this.faSave = faSave;\n      this.editMode = false;\n    }\n\n    ngOnInit() {}\n\n    updateChapter($event, updateType) {\n      $event.preventDefault();\n      let chap = new ChapterDto();\n      chap.id = this.chapter.id;\n      chap.title = this.chapter.title;\n      chap.description = this.chapter.description;\n      this.chapterService.updateChapter(chap, datas => {\n        switch (updateType) {\n          case 'editTitle':\n            this.toggleTitle();\n            break;\n\n          case 'editDescription':\n            this.toggleDescription();\n            break;\n        }\n      });\n    }\n\n    toggleTitle() {\n      this.editTitle = this.editMode && !this.editTitle;\n      this.cd.detectChanges();\n    }\n\n    toggleDescription() {\n      this.editDescription = this.editMode && !this.editDescription;\n      this.cd.detectChanges();\n    }\n\n    getTimeDuration(chapter) {\n      return Math.round(chapter.timeDuration / 1000 / 60) + ' minutes';\n    }\n\n    isLoggedIn() {\n      return this.getUser() !== null;\n    }\n\n    getUser() {\n      return this.authenticationService.getUser();\n    }\n\n    getCurrentChapter() {\n      let currentChapter = (this.getUser() || {}).currentChapter;\n      return currentChapter;\n    }\n\n    updateCurrentChapter($event) {\n      let next = datas => {\n        this.authenticationService.autoLogin(true);\n        let currentChapterUploadId = (datas.currentChapter || {\n          upload: {}\n        }).upload.id;\n        AudioPlayerComponent.reloadCurrentPlayer(currentChapterUploadId, (datas.currentChapter || {}).title);\n      };\n\n      console.log(this.chapterService);\n      this.chapterService.updateCurrentChapter(this.chapter, next);\n    }\n\n    isChecked() {\n      return this.getCurrentChapter() != null && this.getCurrentChapter().id === this.chapter.id;\n    }\n\n  }\n\n  ChapterDetailComponent.ɵfac = function ChapterDetailComponent_Factory(t) {\n    return new (t || ChapterDetailComponent)(i0.ɵɵdirectiveInject(i1.ChapterService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i3.AuthenticationService));\n  };\n\n  ChapterDetailComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ChapterDetailComponent,\n    selectors: [[\"app-chapter-detail\"]],\n    viewQuery: function ChapterDetailComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 7, ElementRef);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.title = _t.first);\n      }\n    },\n    inputs: {\n      chapter: \"chapter\",\n      editMode: \"editMode\"\n    },\n    decls: 4,\n    vars: 5,\n    consts: [[\"class\", \"d-flex flex-column \", 4, \"ngIf\"], [1, \"form-group\", \"text-center\"], [\"width\", \"100\", 3, \"title\", \"showTitle\", \"upload\"], [\"class\", \"float-right \", 4, \"ngIf\"], [1, \"d-flex\", \"flex-column\"], [3, \"ngClass\", \"click\", 4, \"ngIf\"], [\"class\", \"input-group input-group-sm mb-2\", 4, \"ngIf\"], [\"class\", \"bg-light blockquote\", 3, \"click\", 4, \"ngIf\"], [3, \"ngClass\", \"click\"], [1, \"dots\"], [1, \"input-group\", \"input-group-sm\", \"mb-2\"], [\"type\", \"text\", 1, \"form-control\", 3, \"autofocus\", \"ngModel\", \"focusout\", \"ngModelChange\", \"keydown.enter\"], [\"title\", \"\"], [1, \"input-group-append\"], [\"type\", \"button\", 1, \"btn\", \"btn-sm\", \"btn-danger\", 3, \"click\"], [3, \"icon\"], [\"autosize\", \"\", 1, \"form-control\", 3, \"autofocus\", \"ngModel\", \"ngModelChange\"], [\"description\", \"\"], [\"type\", \"button\", 1, \"btn\", \"btn-sm\", \"btn-success\", 3, \"click\"], [1, \"bg-light\", \"blockquote\", 3, \"click\"], [1, \"float-right\"], [1, \"form-check-label\", \"text-uppercase\", \"text-success\", \"mr-2\", 3, \"htmlFor\"], [\"type\", \"checkbox\", 1, \"form-check-inline\", 3, \"id\", \"disabled\", \"checked\", \"change\"]],\n    template: function ChapterDetailComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, ChapterDetailComponent_div_0_Template, 5, 4, \"div\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelement(2, \"app-audio-player\", 2);\n        i0.ɵɵtemplate(3, ChapterDetailComponent_div_3_Template, 4, 4, \"div\", 3);\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.chapter);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"title\", ctx.chapter.title)(\"showTitle\", false)(\"upload\", ctx.chapter.upload);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.isLoggedIn());\n      }\n    },\n    directives: [i4.NgIf, i4.NgClass, i5.DefaultValueAccessor, i6.ɵb, i5.NgControlStatus, i5.NgModel, i7.FaIconComponent, i8.AutosizeDirective, i9.AudioPlayerComponent],\n    styles: [\".dotted[_ngcontent-%COMP%]{display:flex}.dotted[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%], .dotted[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{flex:1 0 auto}.dotted[_ngcontent-%COMP%]   .dots[_ngcontent-%COMP%]{flex:0 1 auto;overflow:hidden}.dots[_ngcontent-%COMP%]:before{display:block;white-space:nowrap;overflow:hidden;text-overflow:clip;content:\\\". . . . . . . . . . . . . . . . . . . . \\\" \\\". . . . . . . . . . . . . . . . . . . . \\\" \\\". . . . . . . . . . . . . . . . . . . . \\\" \\\". . . . . . . . . . . . . . . . . . . . \\\" \\\". . . . . . . . . . . . . . . . . . . . \\\" \\\". . . . . . . . . . . . . . . . . . . . \\\" \\\". . . . . . . . . . . . . . . . . . . . \\\" \\\". . . . . . . . . . . . . . . . . . . . \\\" \\\". . . . . . . . . . . . . . . . . . . . \\\"}\"]\n  });\n  return ChapterDetailComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}