{"ast":null,"code":"import { Slugify } from \"../common/slugify\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../service/book.service\";\nimport * as i2 from \"../service/chapter.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"../service/authenticationservice\";\nimport * as i5 from \"../logo/logo.component\";\nimport * as i6 from \"@fortawesome/angular-fontawesome\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"../audio-player/audio-player.component\";\nimport * as i9 from \"../image-loader/image-loader.component\";\n\nfunction HomeComponent_p_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1, \"You're not logged in.\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction HomeComponent_div_6_span_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 8);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const role_r6 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(role_r6.authority);\n  }\n}\n\nfunction HomeComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\");\n    i0.ɵɵtext(4, \"Your access roles are: \");\n    i0.ɵɵtemplate(5, HomeComponent_div_6_span_5_Template, 2, 1, \"span\", 7);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Welcome \", ctx_r1.getUser().username, \"!\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.getUser().authorities);\n  }\n}\n\nfunction HomeComponent_div_7_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"div\", 13)(2, \"div\", 14);\n    i0.ɵɵelement(3, \"app-audio-player\", 15);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const history_r8 = ctx.$implicit;\n    const ctx_r7 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"linkDetail\", ctx_r7.getChapterDetailLink(history_r8.chapter))(\"updateCurrentTimeUrl\", ctx_r7.getUpdateCurrentTimeUrl(history_r8))(\"currentTime\", history_r8.currentTime)(\"title\", history_r8.chapter.title)(\"upload\", history_r8.chapter.upload);\n  }\n}\n\nfunction HomeComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 1)(1, \"h2\", 9);\n    i0.ɵɵtext(2, \"Your History\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 10);\n    i0.ɵɵtemplate(4, HomeComponent_div_7_div_4_Template, 4, 5, \"div\", 11);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.histories);\n  }\n}\n\nfunction HomeComponent_div_8_div_4_app_image_loader_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-image-loader\", 22);\n  }\n\n  if (rf & 2) {\n    const book_r10 = i0.ɵɵnextContext().$implicit;\n    const ctx_r11 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"routerLink\", ctx_r11.getBookDetailLink(book_r10))(\"customClass\", \"clickable card-img-top \")(\"imageId\", book_r10.cover.id);\n  }\n}\n\nfunction HomeComponent_div_8_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"div\", 18);\n    i0.ɵɵtemplate(2, HomeComponent_div_8_div_4_app_image_loader_2_Template, 1, 3, \"app-image-loader\", 19);\n    i0.ɵɵelementStart(3, \"div\", 14)(4, \"h6\", 20);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"span\", 21);\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"slice\");\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const book_r10 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", book_r10.cover);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(book_r10.title);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", book_r10.description && book_r10.description.length > 100 ? i0.ɵɵpipeBind3(8, 3, book_r10.description, 0, 100) + \"...\" : book_r10.description ? book_r10.description : \"No description available\", \"\");\n  }\n}\n\nfunction HomeComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 1)(1, \"h2\", 9);\n    i0.ɵɵtext(2, \"Latest\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 16);\n    i0.ɵɵtemplate(4, HomeComponent_div_8_div_4_Template, 9, 7, \"div\", 17);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.books);\n  }\n}\n\nfunction HomeComponent_div_9_div_4_app_image_loader_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-image-loader\", 22);\n  }\n\n  if (rf & 2) {\n    const book_r14 = i0.ɵɵnextContext().$implicit;\n    const ctx_r15 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"routerLink\", ctx_r15.getBookDetailLink(book_r14))(\"customClass\", \"clickable card-img-top \")(\"imageId\", book_r14.cover.id);\n  }\n}\n\nfunction HomeComponent_div_9_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"div\", 18);\n    i0.ɵɵtemplate(2, HomeComponent_div_9_div_4_app_image_loader_2_Template, 1, 3, \"app-image-loader\", 19);\n    i0.ɵɵelementStart(3, \"div\", 14)(4, \"h6\", 20);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"span\", 21);\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"slice\");\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const book_r14 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", book_r14.cover);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(book_r14.title);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", book_r14.description && book_r14.description.length > 100 ? i0.ɵɵpipeBind3(8, 3, book_r14.description, 0, 100) + \"...\" : book_r14.description ? book_r14.description : \"No description available\", \"\");\n  }\n}\n\nfunction HomeComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 1)(1, \"h2\", 9);\n    i0.ɵɵtext(2, \"TOP\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 16);\n    i0.ɵɵtemplate(4, HomeComponent_div_9_div_4_Template, 9, 7, \"div\", 11);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.topBooks);\n  }\n}\n\nconst _c0 = function () {\n  return [\"fas\", \"search\"];\n};\n\nexport let HomeComponent = /*#__PURE__*/(() => {\n  class HomeComponent {\n    constructor(bookService, chapterService, router, authenticationService) {\n      this.bookService = bookService;\n      this.chapterService = chapterService;\n      this.router = router;\n      this.authenticationService = authenticationService;\n    }\n\n    isLoggedIn() {\n      return this.getUser() !== null;\n    }\n\n    getUser() {\n      return this.authenticationService.getUser();\n    }\n\n    getBookDetailLink(book) {\n      let link = '/books/' + Slugify.slugify(book.title) + '/' + book.id + '/' + 'view';\n      return link;\n    }\n\n    ngOnInit() {\n      this.loading = true;\n      this.books = null;\n      this.bookService.getLast3Books(datas => {\n        this.books = datas;\n        this.loading = false;\n      });\n      this.bookService.getTop3Books(datas => {\n        this.topBooks = datas;\n        this.loading = false;\n      });\n      this.fetchHistories();\n      this.authenticationService.userEvent.subscribe(event => {\n        console.log(event);\n\n        if (event === 'logout') {\n          this.histories = [];\n        } else {\n          this.fetchHistories();\n        }\n      });\n    }\n\n    getUpdateCurrentTimeUrl(currentChapter) {\n      return `/user/chapter/${currentChapter.chapter.id}/current-time?time=`;\n    }\n\n    fetchHistories() {\n      if (this.isLoggedIn()) {\n        this.chapterService.userHistory(datas => {\n          this.histories = datas;\n        });\n      }\n    }\n\n    getChapterDetailLink(chapter) {\n      let link = '/books/' + Slugify.slugify(chapter.title) + '/' + chapter.bookId + '/' + 'view';\n      return link;\n    }\n\n  }\n\n  HomeComponent.ɵfac = function HomeComponent_Factory(t) {\n    return new (t || HomeComponent)(i0.ɵɵdirectiveInject(i1.BookService), i0.ɵɵdirectiveInject(i2.ChapterService), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i4.AuthenticationService));\n  };\n\n  HomeComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: HomeComponent,\n    selectors: [[\"app-home\"]],\n    decls: 10,\n    vars: 8,\n    consts: [[3, \"headerClass\"], [1, \"container\", \"text-center\"], [\"routerLink\", \"/books\", 1, \"btn\", \"btn-lg\", \"border-0\", \"btn-outline-primary\"], [1, \"fa-2x\", 3, \"icon\"], [1, \"my-4\"], [4, \"ngIf\"], [\"class\", \"container text-center\", 4, \"ngIf\"], [\"class\", \"badge badge-info mr-1\", 4, \"ngFor\", \"ngForOf\"], [1, \"badge\", \"badge-info\", \"mr-1\"], [1, \"text-muted\", \"bg-light\", \"mt-2\", \"text-uppercase\"], [1, \"mb-2\", \"p-2\", \"row\"], [\"class\", \"col-lg-4 \", 4, \"ngFor\", \"ngForOf\"], [1, \"col-lg-4\"], [1, \"card\", \"bg-light\"], [1, \"card-body\", \"border-0\", \"bg-transparent\"], [3, \"linkDetail\", \"updateCurrentTimeUrl\", \"currentTime\", \"title\", \"upload\"], [1, \"row\", \"mb-2\", \"p-2\"], [\"class\", \"col-lg-4\", 4, \"ngFor\", \"ngForOf\"], [1, \"card\"], [3, \"routerLink\", \"customClass\", \"imageId\", 4, \"ngIf\"], [1, \"card-title\", \"font-italic\"], [1, \"card-text\"], [3, \"routerLink\", \"customClass\", \"imageId\"]],\n    template: function HomeComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"app-logo\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1)(2, \"button\", 2);\n        i0.ɵɵelement(3, \"fa-icon\", 3);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(4, \"hr\", 4);\n        i0.ɵɵtemplate(5, HomeComponent_p_5_Template, 2, 0, \"p\", 5);\n        i0.ɵɵtemplate(6, HomeComponent_div_6_Template, 6, 2, \"div\", 5);\n        i0.ɵɵtemplate(7, HomeComponent_div_7_Template, 5, 1, \"div\", 6);\n        i0.ɵɵtemplate(8, HomeComponent_div_8_Template, 5, 1, \"div\", 6);\n        i0.ɵɵtemplate(9, HomeComponent_div_9_Template, 5, 1, \"div\", 6);\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"headerClass\", \"text-center  mt-5  pt-5 \");\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"icon\", i0.ɵɵpureFunction0(7, _c0));\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", !ctx.isLoggedIn());\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.isLoggedIn());\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.isLoggedIn() && ctx.histories && ctx.histories.length);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.books);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.topBooks);\n      }\n    },\n    directives: [i5.LogoComponent, i3.RouterLink, i6.FaIconComponent, i7.NgIf, i7.NgForOf, i8.AudioPlayerComponent, i9.ImageLoaderComponent],\n    pipes: [i7.SlicePipe],\n    styles: [\"\"]\n  });\n  return HomeComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}