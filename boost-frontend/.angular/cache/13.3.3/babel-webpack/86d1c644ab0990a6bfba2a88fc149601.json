{"ast":null,"code":"import { faSignInAlt, faSignOutAlt } from \"@fortawesome/free-solid-svg-icons\";\nimport { Slugify } from \"../common/slugify\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../service/chapter.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../service/authenticationservice\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"ngx-autofocus-fix\";\nimport * as i7 from \"@fortawesome/angular-fontawesome\";\nimport * as i8 from \"../audio-player/audio-player.component\";\nimport * as i9 from \"../notification/notification.component\";\n\nfunction LoginComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵlistener(\"keydown.enter\", function LoginComponent_div_0_Template_div_keydown_enter_0_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return ctx_r2.login();\n    });\n    i0.ɵɵelementStart(1, \"input\", 3);\n    i0.ɵɵlistener(\"ngModelChange\", function LoginComponent_div_0_Template_input_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return ctx_r4.username = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"input\", 4);\n    i0.ɵɵlistener(\"keydown.enter\", function LoginComponent_div_0_Template_input_keydown_enter_2_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return ctx_r5.login();\n    })(\"ngModelChange\", function LoginComponent_div_0_Template_input_ngModelChange_2_listener($event) {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return ctx_r6.password = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function LoginComponent_div_0_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return ctx_r7.login();\n    });\n    i0.ɵɵelementStart(4, \"span\", 6);\n    i0.ɵɵtext(5, \"Sign in\\u00A0\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"fa-icon\", 7);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.username);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.password);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"icon\", ctx_r0.faSignInAlt);\n  }\n}\n\nfunction LoginComponent_div_1_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"app-audio-player\", 11);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r8 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"currentTime\", ctx_r8.currentChapter.currentTime || 0)(\"updateCurrentTimeUrl\", ctx_r8.getUpdateCurrentTimeUrl())(\"currentPlayer\", true)(\"linkDetail\", ctx_r8.getChapterDetailLink())(\"upload\", ctx_r8.currentChapter.chapter.upload)(\"title\", ctx_r8.currentChapter.chapter.title);\n  }\n}\n\nfunction LoginComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 8);\n    i0.ɵɵtemplate(1, LoginComponent_div_1_div_1_Template, 2, 6, \"div\", 9);\n    i0.ɵɵelementStart(2, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function LoginComponent_div_1_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return ctx_r9.logout();\n    });\n    i0.ɵɵelementStart(3, \"span\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"uppercase\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(6, \"\\u00A0 \");\n    i0.ɵɵelement(7, \"fa-icon\", 7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(8, \"app-notification\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.currentChapter);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(5, 3, ctx_r1.getUser().username));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"icon\", ctx_r1.faSignOutAlt);\n  }\n}\n/**\n * @author Nordine Bittich\n */\n\n\nexport class LoginComponent {\n  chapterService;\n  actRoute;\n  router;\n  authenticationService;\n  returnUrl;\n  username;\n  password;\n  faSignInAlt = faSignInAlt;\n  faSignOutAlt = faSignOutAlt;\n  currentChapter;\n\n  constructor(chapterService, actRoute, router, authenticationService) {\n    this.chapterService = chapterService;\n    this.actRoute = actRoute;\n    this.router = router;\n    this.authenticationService = authenticationService;\n  }\n\n  ngOnInit() {\n    this.returnUrl = '';\n    this.actRoute.queryParams.subscribe(params => {\n      this.returnUrl = params['returnUrl'] || '';\n    });\n    this.fetchCurrentChap();\n    this.authenticationService.userEvent.subscribe(value => {\n      if (value === 'login') {\n        this.fetchCurrentChap();\n      }\n    });\n  }\n\n  fetchCurrentChap() {\n    if (this.isLoggedIn()) {\n      this.chapterService.getCurrentChapter(datas => {\n        this.currentChapter = datas;\n      });\n    }\n  }\n\n  isLoggedIn() {\n    return this.getUser() !== null;\n  }\n\n  getUpdateCurrentTimeUrl() {\n    if (this.currentChapter && this.currentChapter.chapter) return `/user/chapter/${this.currentChapter.chapter.id}/current-time?time=`;else return null;\n  }\n\n  getUser() {\n    return this.authenticationService.getUser();\n  }\n\n  logout() {\n    this.authenticationService.logout();\n    this.router.navigate(['/']);\n  }\n\n  hasRole(expected) {\n    return this.authenticationService.hasRole(expected);\n  }\n\n  login() {\n    this.authenticationService.login(this.username, this.password, resp => {\n      console.log(this.returnUrl);\n      this.router.navigateByUrl(this.returnUrl);\n    });\n  }\n\n  getChapterDetailLink() {\n    let link = '/books/' + Slugify.slugify(this.currentChapter.chapter.title) + '/' + this.currentChapter.chapter.bookId + '/' + 'view';\n    return link;\n  }\n\n  static ɵfac = function LoginComponent_Factory(t) {\n    return new (t || LoginComponent)(i0.ɵɵdirectiveInject(i1.ChapterService), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.AuthenticationService));\n  };\n  static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: LoginComponent,\n    selectors: [[\"app-login\"]],\n    decls: 2,\n    vars: 2,\n    consts: [[\"class\", \"form-inline my-2 my-lg-0\", 3, \"keydown.enter\", 4, \"ngIf\"], [\"class\", \"form-inline my-2 my-lg-0\", 4, \"ngIf\"], [1, \"form-inline\", \"my-2\", \"my-lg-0\", 3, \"keydown.enter\"], [\"autocapitalize\", \"none\", \"autofocus\", \"autofocus\", \"name\", \"username\", \"type\", \"text\", \"placeholder\", \"Username\", \"aria-label\", \"Username\", 1, \"border-radius-0\", \"form-control\", \"mr-sm-2\", 3, \"ngModel\", \"ngModelChange\"], [\"name\", \"password\", \"type\", \"password\", \"placeholder\", \"Password\", \"aria-label\", \"Password\", 1, \"form-control\", \"mr-sm-2\", \"border-radius-0\", 3, \"ngModel\", \"keydown.enter\", \"ngModelChange\"], [\"type\", \"button\", 1, \"btn\", \"border-0\", \"btn-outline-secondary\", \"text-uppercase\", 3, \"click\"], [1, \"text-uppercase\"], [3, \"icon\"], [1, \"form-inline\", \"my-2\", \"my-lg-0\"], [4, \"ngIf\"], [\"type\", \"button\", 1, \"btn\", \"border-0\", \"btn-outline-info\", \"my-2\", \"my-sm-0\", 3, \"click\"], [3, \"currentTime\", \"updateCurrentTimeUrl\", \"currentPlayer\", \"linkDetail\", \"upload\", \"title\"]],\n    template: function LoginComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, LoginComponent_div_0_Template, 7, 3, \"div\", 0);\n        i0.ɵɵtemplate(1, LoginComponent_div_1_Template, 9, 5, \"div\", 1);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", !ctx.isLoggedIn());\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.isLoggedIn());\n      }\n    },\n    directives: [i4.NgIf, i5.DefaultValueAccessor, i6.ɵb, i5.NgControlStatus, i5.NgModel, i7.FaIconComponent, i8.AudioPlayerComponent, i9.NotificationComponent],\n    pipes: [i4.UpperCasePipe],\n    styles: [\"\"]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}